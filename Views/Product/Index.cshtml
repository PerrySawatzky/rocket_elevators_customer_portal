@{
    ViewData["Title"] = "Products";
}
@model dynamic
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager


@if (SignInManager.IsSignedIn(User)){   
    var user = await UserManager.GetUserAsync(User);
    
<div>
    <h1 hidden id="userEmailReally">@user.Email</h1>
    <h1 hidden id="userCustomerID"></h1>
</div>

<main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Products</h1>
    </div>
    @*batteries, columns and elevators*@
    @*Each item will provide direct access to the intervention request form, which should be automatically assigned to the selected product. He will also be able to modify his personal information, such as addresses or contact details.*@

    <h3>Account Info</h3>
    <div class="table-responsive">
    <table class="table table-striped table-sm">
        <thead>
        <tr>
            <th scope="col"></th>
            <th scope="col">ID</th>
            <th scope="col">Company</th>
            <th scope="col">Contact</th>
            <th scope="col">Phone</th>
            <th scope="col">Email</th>
            <th scope="col">About</th>
            <th scope="col">Tech Contact</th>
            <th scope="col">Tech Phone</th>
            <th scope="col">Tech Email</th>
        </tr>
        </thead>
        <tbody>
        @foreach (Customer cust in Model.Customer)
       
        if (cust.id == 1)
        {
           
            <tr>
                <td>
                    <a  asp-action="ModifyContactInfo" asp-route-id="@cust.id">
                        modify
                    </a>
                    @* <a asp-page="/ModifyContactInfo" asp-route-id="@cust.id">Test</a> *@
                </td>
                <td>@cust.id</td>
                <td>@cust.company_name</td>
                <td>@cust.company_contact_full_name</td>
                <td>@cust.company_contact_phone</td>
                <td>@cust.company_contact_email</td>
                <td>@cust.company_description</td>
                <td>@cust.service_tech_authority_full_name</td>
                <td>@cust.technical_authority_for_service_phone</td>
                <td>@cust.technical_manager_email_for_service</td>
            </tr>
        }
        </tbody>
    </table>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-sm">
            <thead>
            <tr>
                <th scope="col"></th>
                <th scope="col">ID</th>
                <th scope="col">Type</th>
                <th scope="col">Status</th>
                <th scope="col">Entity</th>
                <th scope="col">Street</th>
                <th scope="col">Suite</th>
                <th scope="col">City</th>
                <th scope="col">Zip</th>
                <th scope="col">Country</th>
                <th scope="col">Notes</th>
            </tr>
            </thead>
            <tbody>
            @foreach (Address add in Model.Address)
            {
                <tr>
                    <td>
                        <a  asp-action="ModifyAddressInfo" asp-route-id="@add.id">
                            modify
                        </a>
                        @* <a asp-page="/ModifyContactInfo" asp-route-id="@cust.id">Test</a> *@
                    </td>
                    <td>@add.id</td>
                    <td>@add.address_type</td>
                    <td>@add.status</td>
                    <td>@add.entity</td>
                    <td>@add.number_and_street</td>
                    <td>@add.suite_or_apartment</td>
                    <td>@add.city</td>
                    <td>@add.postal_code</td>
                    <td>@add.country</td>
                    <td>@add.notes</td>
                </tr>
            }
            </tbody>
        </table>

    </div>
    
            <div class="table-responsive">
                <table class="table table-striped table-sm">
                    <thead>
                        <tr>
                            <th scope="col">ID</th>
                            <th scope="col">Admin</th>
                            <th scope="col">Email</th>
                            <th scope="col">Phone #</th>
                            <th scope="col">Tech Contact</th>
                            <th scope="col">Tech Email</th>
                            <th scope="col">Tech Phone</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (Building bldg in Model.Building)
                        {
                        <tr>
                            <td>@bldg.id</td>
                            <td>@bldg.full_name_of_the_building_administrator</td>
                            <td>@bldg.email_of_the_administrator_of_the_building</td>
                            <td>@bldg.phone_number_of_the_building_administrator</td>
                            <td>@bldg.full_name_of_the_technical_contact_for_the_building</td>
                            <td>@bldg.technical_contact_email_for_the_building</td>
                            <td>@bldg.technical_contact_phone_for_the_building</td>
                        </tr>
                        }
                    </tbody>
                </table>
    
            </div>

    <h3>Batteries</h3>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Type</th>
                        <th scope="col">Status</th>
                        <th scope="col">Commission</th>
                        <th scope="col">Inspected</th>
                        <th scope="col">Certified by</th>
                        <th scope="col">Info</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Battery batt in Model.Batteries)
                    {
                        <tr>
                            <td>@batt.id</td>
                            <td>@batt.battery_type</td>
                            <td>@batt.status</td>
                            <td>@batt.commissioned_date</td>
                            <td>@batt.last_inspection_date</td>
                            <td>@batt.certificate_of_operations</td>
                            <td>@batt.information</td>
                            <td>@batt.notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <h3>Columns</h3>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Type</th>
                        <th scope="col">Floors</th>
                        <th scope="col">Status</th>
                        <th scope="col">Info</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Column col in Model.Columns)
                    {
                        <tr>
                            <td>@col.id</td>
                            <td>@col.column_type</td>
                            <td>@col.num_floors_served</td>
                            <td>@col.status</td>
                            <td>@col.information</td>
                            <td>@col.notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <h3>Elevators</h3>
        <div class="table-responsive">
            <table class="table table-striped table-sm">
                <thead>
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Serial #</th>
                        <th scope="col">Model</th>
                        <th scope="col">Type</th>
                        <th scope="col">Status</th>
                        <th scope="col">Commission</th>
                        <th scope="col">Inspected</th>
                        <th scope="col">Certified by</th>
                        <th scope="col">Info</th>
                        <th scope="col">Notes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (Elevator elev in Model.Elevators)
                    {
                        <tr>
                            <td>@elev.id</td>
                            <td>@elev.serial_number</td>
                            <td>@elev.model</td>
                            <td>@elev.elevator_type</td>
                            <td>@elev.status</td>
                            <td>@elev.date_of_commissioning</td>
                            <td>@elev.last_inspection</td>
                            <td>@elev.certificate_of_inspection</td>
                            <td>@elev.information</td>
                            <td>@elev.notes</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

</main>
}
@section Scripts {
    <script>
$( document ).ready(function() {
var userEmail = document.getElementById("userEmailReally").innerHTML;
    $.ajax({
        cache: false,
        url: 'https://whispering-tundra-91467.herokuapp.com/api/customers/',
        type: 'GET',
        dataType: 'json',
        success: function (obj) {
            for (var i = 0; i < obj.length; i++){
                if (obj[i].company_contact_email == userEmail){                            
                    console.log("Just the id",obj[i].id);
                    document.getElementById('userCustomerID').value = obj[i].id;
                    
                    console.log("You fucking wizard",document.getElementById("userCustomerID").value);
                }
            }
        },
        error: function (obj) {
            console.log('Something happened');
        }
    });
});
</script>
}
    
