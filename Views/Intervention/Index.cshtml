@model dynamic
@{
    ViewData["Title"] = "Intervention Form";
}
@using Microsoft.AspNetCore.Identity
@inject SignInManager<IdentityUser> SignInManager
@inject UserManager<IdentityUser> UserManager
<link href="dashboard.css" rel="stylesheet">


@if (SignInManager.IsSignedIn(User))
{
    var user = await UserManager.GetUserAsync(User);
<div>
    <h1>Below</h1>
    <h1>@user.Email</h1>
    <h1>Above</h1>
</div>
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
        <h1 class="h2">Intervention Form</h1>
    </div>

    <form method="post" name="" id="">
        <div class="row">
            <div class="col-md-3">
                <select class="form-control" id="battery-id">
                    <option selected>Select Building</option>
                    
                </select>
                
                
                
                <select class="custom-select">
                    <option selected>Select Building</option>
                    @foreach (Building b in Model.Buildings)
                    {
                        <option value="@b.id">@b.id</option>
                    }
                </select>

                <select class="custom-select">
                    <option selected>Select Battery</option>
                    @foreach (Battery batt in Model.Batteries)
                    {
                        <option value="@batt.id">@batt.id</option>
                    }
                </select>
                <select class="custom-select">
                    <option selected>Select Column</option>
                    @foreach (Column col in Model.Columns)
                    {
                        <option value="@col.id">@col.id</option>
                    }
                </select>
                <select class="custom-select">
                    <option selected>Select Elevator</option>
                    @foreach (Elevator elev in Model.Elevators)
                    {
                        <option value="@elev.id">@elev.id</option>
                    }
                </select>

                <div class="row">
                    <div class="col-md-12">
                        <label for="textarea">Report</label><br />
                        <textarea id="textarea" rows="5" cols="40"></textarea>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <button onclick="" class="btn btn-primary"><i class="fa fa-check"></i> SUBMIT </button>
                    </div>
                </div>

            </div>
        </div>
    </form>

</main>


}
@if (SignInManager.IsSignedIn(User) == false)
{
     <div class="text-center">
        <h1 class="display-4">Please log in</h1>
        <a asp-action="index" asp-controller="home">Home</a> <br>
    </div>
}
@section Scripts
{
    <script>


       $( document ).ready(function() {
    
    customer_select = $("#customer_div");
    building_select = $('#building_div');
    battery_select = $('#battery_div');
    column_select = $('#column_div');
    elevator_select = $('#elevator_div');

    building_select.css("visibility", "hidden");
    battery_select.css("visibility", "hidden");
    column_select.css("visibility", "hidden");
    elevator_select.css("visibility", "hidden");

// Buildings drop down
    $("#intervention_customer_id").change(function() {
      
      if (customer_select == '') {

      }else{
        building_select.css("visibility", "visible");
        battery_select.css("visibility", "hidden");
        column_select.css("visibility", "hidden");
        elevator_select.css("visibility", "hidden");
      }

      var customer_id_selected = $(this).val();
      console.log('selected customer id: ', $(this).val() );

      var customer_id_selected = $(this).val();
      $.get('/interventions/intervention_building_id', {customer_id: customer_id_selected}, function(result) {

        var buildings = result["buildings"];
        $("#intervention_building_id").empty();
        $("#intervention_battery_id").empty();
        $("#intervention_column_id").empty();
        $("#intervention_elevator_id").empty();
        $("#intervention_building_id").append('<option>Select Building</option>');
        $.each(result, function(i, j) {
          var row = '<option value="' + j.id + '">' + j.id + '</option>';
          // console.log(row);
          $(row).appendTo("#intervention_building_id")
        });
      });
    });

  // Batteries drop down
  $("#intervention_building_id").change(function() {
      
      if (building_select == '') {

      }else{
        battery_select.css("visibility", "visible");
        column_select.css("visibility", "hidden");
        elevator_select.css("visibility", "hidden");
      }
      
      var building_id_selected = $(this).val();
      console.log('selected building id: ', $(this).val())
      $.get('/interventions/intervention_battery_id', {building_id: building_id_selected}, function(result) {

        $("#intervention_battery_id").empty();
        $("#intervention_column_id").empty();
        $("#intervention_elevator_id").empty();
        $("#intervention_battery_id").append('<option>None</option>');
        $.each(result, function(i, j) {
          var row = '<option value="' + j.id + '">' + j.id + '</option>';
          
          $(row).appendTo("#intervention_battery_id")
        });
      });
    });

  $('.advanced-reset-btn').click(function() { $('#intervention')[0].reset() })
  // Column drop down 
  $("#intervention_battery_id").change(function() {
      
      if (battery_select == '') {

      }else{
        column_select.css("visibility", "visible");
        elevator_select.css("visibility", "hidden");
      }

      var battery_id_selected = $(this).val();
      console.log('selected battery id: ', $(this).val())
      
      $.get('/interventions/intervention_column_id', {battery_id: battery_id_selected}, function(result) {

        $("#intervention_column_id").empty();
        $("#intervention_elevator_id").empty();
        $("#intervention_column_id").append('<option>None</option>');
        $.each(result, function(i, j) {
          var row = '<option value="' + j.id + '">' + j.id + '</option>';
          
          $(row).appendTo("#intervention_column_id")
        });
      });
    });

  // Elevator dropdown menu
  $("#intervention_column_id").change(function() {
    if (column_select == '') {
      }else{
        elevator_select.css("visibility", "visible");
      }
      var column_id_selected = $(this).val();
      console.log('selected column id: ', $(this).val())
      $.get('/interventions/intervention_elevator_id', {column_id: column_id_selected}, function(result) {

        $("#intervention_elevator_id").empty();
        $("#intervention_elevator_id").append('<option>None</option>');
        $.each(result, function(i, j) {
          var row = '<option value="' + j.id + '">' + j.id + '</option>';
          
          $(row).appendTo("#intervention_elevator_id")
        });
      });
    });
  });
    </script>

    @* <script>
        $(document).ready(function(){
            $("#intervention_building_id").hide();
            $("#intervention_battery_id").hide();
            $("#intervention_column_id").hide();
            $("#intervention_elevator_id").hide();
            // $("#description").hide();
        });

        // $("#building_id").prop("disabled", true);
        $('#intervention_customer_id').on('change', function() {
            $('#intervention_building_id').show()
            $("#intervention_building_id").empty();
            $("#intervention_battery_id").empty();
            $("#intervention_column_id").empty();
            $("#intervention_elevator_id").empty();
            // let customer_id = $("#intervention_customer_id option:selected").val();
            customer_id = $(this).val();
            console.log(customer_id)
            $.ajax({
                cache: false,
                url: 'https://whispering-tundra-91467.herokuapp.com/api/buildings/',
                type: 'GET',
                dataType: 'json',
                data: {
                    id: customer_id
                },
                success: function (data) {
                    console.log(data)
                    console.log('TEST/////////////')
                    var data = data["buildings"]
                    console.log(data)
                    $("#intervention_building_id").empty();
                    $("#intervention_building_id").append('<option>Select Building</option>');
                    // $("#building_id").append(new Option('Select Building'));
                    for (var i = 0; i < data.length; i++) {
                        $("#intervention_building_id").append('<option value="' + data[i]["id"] + '">' + data[i]["id"] + '</option>');
                    }
                }
            })
        });

        //////////// BATTERY ////////////
        $('#intervention_building_id').on('change', function() {
            $('#intervention_battery_id').show()
            $("#intervention_battery_id").empty();
            $("#intervention_column_id").empty();
            $("#intervention_elevator_id").empty();
            //let building_id = $("#building_id option:selected").val();
            building_id = $(this).val();
            console.log(building_id)
            $.ajax({
                cache: false,
                url: 'https://whispering-tundra-91467.herokuapp.com/api/batteries/',
                type: 'GET',
                dataType: 'json',
                data: {
                    id: building_id
                },
                success: function (data) {
                    console.log(data)
                    console.log('TEST/////////////')
                    var data = data["batteries"]
                    console.log(data)

                    $("#intervention_battery_id").empty();
                    $("#intervention_battery_id").append('<option>Select Battery</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#intervention_battery_id").append('<option value="' + data[i]["id"] + '">' + data[i]["id"] + '</option>');
                    }
                }
            })
        });

        //////////// COLUMN ////////////
        $('#intervention_battery_id').on('change', function() {
            $('#intervention_column_id').show()
            $("#intervention_column_id").empty();
            $("#intervention_elevator_id").empty();
            //let building_id = $("#building_id option:selected").val();
            battery_id = $(this).val();
            console.log(battery_id)
            $.ajax({
                cache: false,
                url: 'https://whispering-tundra-91467.herokuapp.com/api/columns/',
                type: 'GET',
                dataType: 'json',
                data: {
                    id: battery_id
                },
                success: function (data) {
                    console.log(data)
                    console.log('TEST/////////////')
                    var data = data["columns"]
                    console.log(data)

                    $("#intervention_column_id").empty();
                    $("#intervention_column_id").append('<option>Select Column</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#intervention_column_id").append('<option value="' + data[i]["id"] + '">' + data[i]["id"] + '</option>');
                    }
                }
            })
        });

        //////////// ELEVATOR ////////////
        $('#intervention_column_id').on('change', function() {
            $('#intervention_elevator_id').show()
            $("#intervention_elevator_id").empty();
            //let building_id = $("#building_id option:selected").val();
            column_id = $(this).val();
            console.log(column_id)
            $.ajax({
                cache: false,
                url: 'https://whispering-tundra-91467.herokuapp.com/api/elevators/',
                type: 'GET',
                dataType: 'json',
                data: {
                    id: column_id
                },
                success: function (data) {
                    console.log(data)
                    console.log('TEST/////////////')
                    var data = data["elevators"]
                    console.log(data)

                    $("#intervention_elevator_id").empty();
                    $("#intervention_elevator_id").append('<option>Select Elevator</option>');
                    for (var i = 0; i < data.length; i++) {
                        $("#intervention_elevator_id").append('<option value="' + data[i]["id"] + '">' + data[i]["id"] + '</option>');
                    }
                }
            })
        });
    </script> *@
}
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" crossorigin="anonymous"></script>
<script src="~/js/dashboard.js"></script>
